!function(a){function b(b){return(a(b).data("tagsInputSettings")||{}).delimiters}function c(b){return(a(b).data("tagsInputSettings")||{}).callbacks}function d(c){var d=b(c);return"string"==typeof delimiter?d:a.isArray(d)?d[0]:","}function e(b,c){if(a.isArray(b))return b;if(!b||"string"!=typeof b)return[];if(!c||0===c.length)return[b];var d=c;if("string"!=typeof c&&(d=c[0],c.length>1)){var e=new RegExp(c.join("|"),"gi");b=b.replace(e,d)}return b.split(d)}a.fn.doAutosize=function(b){var c=a(this),d=c.data("minwidth"),e=c.data("maxwidth"),f="",g=a("#"+c.data("tester_id"));if(f!==(f=c.val())){var h=f.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");g.html(h);var i=g.width(),j=i+b.comfortZone>=d?i+b.comfortZone:d;(j<c.width()&&j>=d||j>d&&j<e)&&c.width(j)}},a.fn.resetAutosize=function(b){var c=a(this),d=c.data("minwidth")||b.minInputWidth||c.width(),e=c.data("maxwidth")||b.maxInputWidth||c.closest(".tagsinput").width()-b.inputPadding,f=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:c.css("fontSize"),fontFamily:c.css("fontFamily"),fontWeight:c.css("fontWeight"),letterSpacing:c.css("letterSpacing"),whiteSpace:"nowrap"}),g=c.attr("id")+"_autosize_tester";a("#"+g).length||(f.attr("id",g),f.appendTo("body")),c.data("minwidth",d),c.data("maxwidth",e),c.data("tester_id",g),c.css("width",d)},a.fn.addTag=function(d,f){return f=a.extend({focus:!1,callback:!0},f),this.each(function(){var g=a(this),h=g.attr("id"),i=b(g),j=c(g),k=e(g.val(),i);d=a.trim(d);var l=!1;if(f.unique&&(l=g.tagExist(d),!l&&j.tagValidator&&(l=""!==d&&!j.tagValidator(d)),1==l&&a("#"+h+"_tag").addClass("not_valid")),""!=d&&1!=l&&(a("<span>").addClass("tag").append(a("<span>").text(d),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+h).removeTag(escape(d))})).insertBefore("#"+h+"_addTag"),k.push(d),a("#"+h+"_tag").val(""),f.focus?a("#"+h+"_tag").focus():a("#"+h+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,k),f.callback&&(j.onAddTag&&j.onAddTag.call(this,d),j.onChange))){var m=k.length;j.onChange.call(this,a(this),k[m-1])}}),!1},a.fn.removeTag=function(f){return f=unescape(f),this.each(function(){var g=a(this),h=g.attr("id"),i=b(g),j=c(g),k=e(g.val(),i);a("#"+h+"_tagsinput .tag").remove();for(var l="",m=0;m<k.length;m++)k[m]!=f&&(l=l+d(h)+k[m]);a.fn.tagsInput.importTags(this,l),j.onRemoveTag&&j.onRemoveTag.call(this,f)}),!1},a.fn.tagExist=function(c){var d=a(this),f=b(d),g=e(d.val(),f);return a.inArray(c,g)>=0},a.fn.importTags=function(b){return this.each(function(){var c=a(this).attr("id");a("#"+c+"_tagsinput .tag").remove(),a.fn.tagsInput.importTags(this,b)}),this},a.fn.tagsInput=function(b){var c=a.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"auto",height:"auto",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},b),d=0;return this.each(function(){var b=a(this);if(void 0===b.attr("data-tagsinput-init")){b.attr("data-tagsinput-init",!0),c.hide&&b.hide();var e=b.attr("id");e||(e="tags"+(new Date).getTime()+d++,b.attr("id",e));var g=a.extend({pid:e,real_input:"#"+e,holder:"#"+e+"_tagsinput",input_wrapper:"#"+e+"_addTag",fake_input:"#"+e+"_tag"},c),h={delimiters:g.delimiter||[","]};(c.onAddTag||c.onRemoveTag||c.onChange||c.tagValidator)&&(h.callbacks={onAddTag:c.onAddTag,onRemoveTag:c.onRemoveTag,onChange:c.onChange,tagValidator:c.tagValidator}),b.data("tagsInputSettings",h);var i='<div id="'+e+'_tagsinput" class="tagsinput"><div id="'+e+'_addTag">';c.interactive&&(i=i+'<input id="'+e+'_tag" value="" data-default="'+c.defaultText+'" />'),i+='</div><div class="tags_clear"></div></div>',a(i).insertAfter(this);var j=a(g.holder),k=a(g.real_input);if(j.css("width",c.width),j.css("min-height",c.height),j.css("height",c.height),""!=k.val()&&a.fn.tagsInput.importTags(k,k.val()),c.interactive){var l=a(g.fake_input);if(l.val(l.attr("data-default")),l.css("color",c.placeholderColor),l.resetAutosize(c),j.bind("click",g,function(b){a(b.data.fake_input).focus()}),l.bind("focus",g,function(b){a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")&&a(b.data.fake_input).val(""),a(b.data.fake_input).css("color","#000000")}),void 0!=c.autocomplete_url){var m={source:c.autocomplete_url};for(var n in c.autocomplete)m[n]=c.autocomplete[n];void 0!==a.Autocompleter?(l.autocomplete(c.autocomplete_url,c.autocomplete),l.bind("result",g,function(b,d){d&&a("#"+e).addTag(d[0]+"",{focus:!0,unique:c.unique})})):void 0!==a.ui.autocomplete&&(l.autocomplete(m),l.bind("autocompleteselect",g,function(b,d){return a(b.data.real_input).addTag(d.item.value,{focus:!0,unique:c.unique}),!1}))}else l.bind("blur",g,function(b){var d=a(this).attr("data-default");return""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=d?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:c.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),a(b.data.fake_input).css("color",c.placeholderColor)),!1});l.bind("keypress",g,function(b){if(f(b))return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:c.unique}),a(b.data.fake_input).resetAutosize(c),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(c)}),g.removeWithBackspace&&l.bind("keydown",function(b){var c=a(this);if(8==b.keyCode&&""==c.val()){b.preventDefault();var d=c.closest(".tagsinput").find(".tag:last span").text(),e=c.attr("id").replace(/_tag$/,"");a("#"+e).removeTag(escape(d)),c.trigger("focus")}}),l.blur(),g.unique&&l.keydown(function(b){(8==b.keyCode||String.fromCharCode(b.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,\/]+/))&&a(this).removeClass("not_valid")})}}}),this},a.fn.tagsInput.updateTagsField=function(b,c){a(b).val(c.join(d(b)))},a.fn.tagsInput.importTags=function(d,f){a(d).val("");for(var g=c(d),h=e(f,b(d)),i=0;i<h.length;i++)a(d).addTag(h[i],{focus:!1,callback:!1});g.onChange&&g.onChange.call(d,d,h[i])};var f=function(b){var c=!1;return 13==b.which||("string"==typeof b.data.delimiter?b.which==b.data.delimiter.charCodeAt(0)&&(c=!0):a.each(b.data.delimiter,function(a,d){b.which==d.charCodeAt(0)&&(c=!0)}),c)}}(jQuery);