!function(a){function b(b){var c=d[b];return"string"==typeof d?c:a.isArray(c)?c[0]:","}function c(b,c){if(a.isArray(b))return b;if(!b||"string"!=typeof b)return[];if(!c||0===c.length)return[b];var d=c;if("string"!=typeof c&&(d=c.shift(),c.length)){var e=new RegExp(c.join("|"),"gi");b=b.replace(e,d)}return b.split(d)}var d=[],e=[];a.fn.doAutosize=function(b){var c=a(this),d=c.data("minwidth"),e=c.data("maxwidth"),f="",g=a("#"+c.data("tester_id"));if(f!==(f=c.val())){var h=f.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");g.html(h);var i=g.width(),j=i+b.comfortZone>=d?i+b.comfortZone:d;(j<c.width()&&j>=d||j>d&&j<e)&&c.width(j)}},a.fn.resetAutosize=function(b){var c=a(this),d=c.data("minwidth")||b.minInputWidth||c.width(),e=c.data("maxwidth")||b.maxInputWidth||c.closest(".tagsinput").width()-b.inputPadding,f=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:c.css("fontSize"),fontFamily:c.css("fontFamily"),fontWeight:c.css("fontWeight"),letterSpacing:c.css("letterSpacing"),whiteSpace:"nowrap"}),g=c.attr("id")+"_autosize_tester";a("#"+g).length||(f.attr("id",g),f.appendTo("body")),c.data("minwidth",d),c.data("maxwidth",e),c.data("tester_id",g),c.css("width",d)},a.fn.addTag=function(b,f){return f=a.extend({focus:!1,callback:!0},f),this.each(function(){var g=a(this),h=g.attr("id"),i=c(g.val(),d[h]);b=a.trim(b);var j=!1;if(f.unique&&(j=g.tagExist(b),!j&&e[h]&&e[h].tagValidator&&(j=""!==b&&!e[h].tagValidator(b)),1==j&&a("#"+h+"_tag").addClass("not_valid")),""!=b&&1!=j&&(a("<span>").addClass("tag").append(a("<span>").text(b),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+h).removeTag(escape(b))})).insertBefore("#"+h+"_addTag"),i.push(b),a("#"+h+"_tag").val(""),f.focus?a("#"+h+"_tag").focus():a("#"+h+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,i),f.callback&&e[h]&&(e[h].onAddTag&&e[h].onAddTag.call(this,b),e[h].onChange))){var k=i.length;e[h].onChange.call(this,a(this),i[k-1])}}),!1},a.fn.removeTag=function(f){return f=unescape(f),this.each(function(){var g=a(this),h=g.attr("id"),i=c(g.val(),d[h]);a("#"+h+"_tagsinput .tag").remove();for(var j="",k=0;k<i.length;k++)i[k]!=f&&(j=j+b(h)+i[k]);a.fn.tagsInput.importTags(this,j),e[h]&&e[h].onRemoveTag&&e[h].onRemoveTag.call(this,f)}),!1},a.fn.tagExist=function(b){var e=a(this),f=e.attr("id"),g=c(e.val(),d[f]);return a.inArray(b,g)>=0},a.fn.importTags=function(b){return this.each(function(){var c=a(this).attr("id");a("#"+c+"_tagsinput .tag").remove(),a.fn.tagsInput.importTags(this,b)}),this},a.fn.tagsInput=function(b){var c=a.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"auto",height:"auto",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},b),g=0;return this.each(function(){var b=a(this);if(void 0===b.attr("data-tagsinput-init")){b.attr("data-tagsinput-init",!0),c.hide&&b.hide();var h=b.attr("id");h&&!d[h]||(h="tags"+(new Date).getTime()+g++,b.attr("id",h));var i=a.extend({pid:h,real_input:"#"+h,holder:"#"+h+"_tagsinput",input_wrapper:"#"+h+"_addTag",fake_input:"#"+h+"_tag"},c);d[h]=i.delimiter,(c.onAddTag||c.onRemoveTag||c.onChange||c.tagValidator)&&(e[h]={onAddTag:c.onAddTag,onRemoveTag:c.onRemoveTag,onChange:c.onChange,tagValidator:c.tagValidator});var j='<div id="'+h+'_tagsinput" class="tagsinput"><div id="'+h+'_addTag">';c.interactive&&(j=j+'<input id="'+h+'_tag" value="" data-default="'+c.defaultText+'" />'),j+='</div><div class="tags_clear"></div></div>',a(j).insertAfter(this);var k=a(i.holder),l=a(i.real_input);if(k.css("width",c.width),k.css("min-height",c.height),k.css("height",c.height),""!=l.val()&&a.fn.tagsInput.importTags(l,l.val()),c.interactive){var m=a(i.fake_input);if(m.val(m.attr("data-default")),m.css("color",c.placeholderColor),m.resetAutosize(c),k.bind("click",i,function(b){a(b.data.fake_input).focus()}),m.bind("focus",i,function(b){a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")&&a(b.data.fake_input).val(""),a(b.data.fake_input).css("color","#000000")}),void 0!=c.autocomplete_url){var n={source:c.autocomplete_url};for(var o in c.autocomplete)n[o]=c.autocomplete[o];void 0!==a.Autocompleter?(m.autocomplete(c.autocomplete_url,c.autocomplete),m.bind("result",i,function(b,d){d&&a("#"+h).addTag(d[0]+"",{focus:!0,unique:c.unique})})):void 0!==a.ui.autocomplete&&(m.autocomplete(n),m.bind("autocompleteselect",i,function(b,d){return a(b.data.real_input).addTag(d.item.value,{focus:!0,unique:c.unique}),!1}))}else m.bind("blur",i,function(b){var d=a(this).attr("data-default");return""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=d?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:c.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),a(b.data.fake_input).css("color",c.placeholderColor)),!1});m.bind("keypress",i,function(b){if(f(b))return b.preventDefault(),b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:c.unique}),a(b.data.fake_input).resetAutosize(c),!1;b.data.autosize&&a(b.data.fake_input).doAutosize(c)}),i.removeWithBackspace&&m.bind("keydown",function(b){var c=a(this);if(8==b.keyCode&&""==c.val()){b.preventDefault();var d=c.closest(".tagsinput").find(".tag:last").text(),e=c.attr("id").replace(/_tag$/,"");d=d.replace(/[\s]+x$/,""),a("#"+e).removeTag(escape(d)),c.trigger("focus")}}),m.blur(),i.unique&&m.keydown(function(b){(8==b.keyCode||String.fromCharCode(b.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,\/]+/))&&a(this).removeClass("not_valid")})}}}),this},a.fn.tagsInput.updateTagsField=function(c,d){var e=a(c).attr("id");a(c).val(d.join(b(e)))},a.fn.tagsInput.importTags=function(b,f){a(b).val("");for(var g=a(b).attr("id"),h=c(f,d[g]),i=0;i<h.length;i++)a(b).addTag(h[i],{focus:!1,callback:!1});e[g]&&e[g].onChange&&e[g].onChange.call(b,b,h[i])};var f=function(b){var c=!1;return 13==b.which||("string"==typeof b.data.delimiter?b.which==b.data.delimiter.charCodeAt(0)&&(c=!0):a.each(b.data.delimiter,function(a,d){b.which==d.charCodeAt(0)&&(c=!0)}),c)}}(jQuery);